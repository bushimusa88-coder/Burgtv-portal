<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Portal - Dynamic URLs</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        
        .test-section {
            background: #2a2a2a;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        
        input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            background: #333;
            color: #fff;
            border: 1px solid #555;
            border-radius: 4px;
        }
        
        button {
            padding: 10px 20px;
            background: #B94A8E;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        button:hover {
            background: #a04080;
        }
        
        .result {
            margin-top: 20px;
            padding: 15px;
            background: #1a1a1a;
            border-radius: 4px;
            white-space: pre-wrap;
            word-break: break-all;
        }
        
        .success {
            border-left: 4px solid #10b981;
        }
        
        .error {
            border-left: 4px solid #ef4444;
        }
        
        .info {
            border-left: 4px solid #3b82f6;
        }
        
        h1 {
            color: #B94A8E;
        }
        
        h2 {
            color: #d85aa3;
        }
        
        .test-urls {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .test-url {
            background: #1a1a1a;
            padding: 10px;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .test-url:hover {
            background: #333;
        }
        
        .url-type {
            color: #10b981;
            font-weight: bold;
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <h1>üß™ BurgTV Portal Test - Dynamic URLs</h1>
    
    <div class="test-section">
        <h2>Test Dynamic IPTV URLs</h2>
        <p>Click on any URL below to test it:</p>
        
        <div class="test-urls">
            <div class="test-url" onclick="testUrl('http://tarmat.targetuno.top:80/get.php?username=nicojess&password=jnkQAFg&type=m3u_plus&output=ts')">
                <span class="url-type">[DYNAMIC]</span>
                http://tarmat.targetuno.top:80/get.php?username=nicojess&password=jnkQAFg&type=m3u_plus&output=ts
            </div>
            
            <div class="test-url" onclick="testUrl('http://example.com:8080/get.php?username=test&password=test123&type=m3u_plus')">
                <span class="url-type">[DYNAMIC]</span>
                http://example.com:8080/get.php?username=test&password=test123&type=m3u_plus
            </div>
            
            <div class="test-url" onclick="testUrl('https://iptv-org.github.io/iptv/countries/it.m3u')">
                <span class="url-type">[STATIC]</span>
                https://iptv-org.github.io/iptv/countries/it.m3u
            </div>
            
            <div class="test-url" onclick="testUrl('http://provider.com/playlist.m3u8?token=abc123&expire=1234567890')">
                <span class="url-type">[TOKEN]</span>
                http://provider.com/playlist.m3u8?token=abc123&expire=1234567890
            </div>
        </div>
    </div>
    
    <div class="test-section">
        <h2>Manual URL Test</h2>
        <input type="text" id="testUrl" placeholder="Enter your IPTV URL here..." value="http://tarmat.targetuno.top:80/get.php?username=nicojess&password=jnkQAFg&type=m3u_plus&output=ts">
        <button onclick="testManualUrl()">Test URL</button>
        
        <div id="result"></div>
    </div>
    
    <div class="test-section">
        <h2>Test Device Registration</h2>
        <input type="text" id="macAddress" placeholder="MAC Address (e.g., 00:1A:79:EE:8F:3A)" value="00:1A:79:EE:8F:3A">
        <input type="text" id="m3uUrl" placeholder="M3U URL" value="http://tarmat.targetuno.top:80/get.php?username=nicojess&password=jnkQAFg&type=m3u_plus&output=ts">
        <button onclick="registerDevice()">Register Device</button>
        
        <div id="registerResult"></div>
    </div>
    
    <div class="test-section">
        <h2>View Registered Devices</h2>
        <button onclick="viewDevices()">View All Devices</button>
        <div id="devicesResult"></div>
    </div>
    
    <script>
        function testUrl(url) {
            document.getElementById('testUrl').value = url;
            testManualUrl();
        }
        
        function testManualUrl() {
            const url = document.getElementById('testUrl').value.trim();
            const resultDiv = document.getElementById('result');
            
            if (!url) {
                showResult(resultDiv, 'Please enter a URL', 'error');
                return;
            }
            
            // Validate URL format
            let isValid = false;
            let urlType = 'UNKNOWN';
            let details = {};
            
            // Check if it starts with http:// or https://
            if (!url.startsWith('http://') && !url.startsWith('https://')) {
                showResult(resultDiv, `‚ùå Invalid URL: Must start with http:// or https://\n\nProvided: ${url}`, 'error');
                return;
            }
            
            // Parse URL
            try {
                const urlObj = new URL(url);
                details.protocol = urlObj.protocol;
                details.hostname = urlObj.hostname;
                details.port = urlObj.port || (urlObj.protocol === 'https:' ? '443' : '80');
                details.pathname = urlObj.pathname;
                details.params = {};
                
                // Parse query parameters
                urlObj.searchParams.forEach((value, key) => {
                    details.params[key] = value;
                });
                
                // Determine URL type
                if (Object.keys(details.params).length > 0) {
                    if (details.params.username || details.params.password || details.params.type === 'm3u_plus') {
                        urlType = 'DYNAMIC IPTV';
                        isValid = true;
                    } else if (details.params.token) {
                        urlType = 'TOKEN-BASED';
                        isValid = true;
                    } else {
                        urlType = 'PARAMETERIZED';
                        isValid = true;
                    }
                } else if (url.endsWith('.m3u') || url.endsWith('.m3u8')) {
                    urlType = 'STATIC M3U';
                    isValid = true;
                } else {
                    urlType = 'GENERIC';
                    isValid = true; // Accept all URLs that start with http/https
                }
                
                let resultText = `‚úÖ Valid URL Format\n\n`;
                resultText += `Type: ${urlType}\n`;
                resultText += `Protocol: ${details.protocol}\n`;
                resultText += `Host: ${details.hostname}\n`;
                resultText += `Port: ${details.port}\n`;
                resultText += `Path: ${details.pathname}\n`;
                
                if (Object.keys(details.params).length > 0) {
                    resultText += `\nParameters:\n`;
                    for (const [key, value] of Object.entries(details.params)) {
                        resultText += `  ${key}: ${value}\n`;
                    }
                }
                
                resultText += `\nüìù This URL will be accepted by the portal and stored as-is.`;
                
                showResult(resultDiv, resultText, 'success');
                
            } catch (error) {
                showResult(resultDiv, `‚ùå Invalid URL: ${error.message}\n\nProvided: ${url}`, 'error');
            }
        }
        
        function registerDevice() {
            const macAddress = document.getElementById('macAddress').value.trim();
            const m3uUrl = document.getElementById('m3uUrl').value.trim();
            const resultDiv = document.getElementById('registerResult');
            
            if (!macAddress || !m3uUrl) {
                showResult(resultDiv, 'Please enter both MAC Address and M3U URL', 'error');
                return;
            }
            
            // Validate MAC format
            if (!/^([0-9A-Fa-f]{2}[:-]){5}([0-9A-Fa-f]{2})$/.test(macAddress)) {
                showResult(resultDiv, 'Invalid MAC address format. Use AA:BB:CC:DD:EE:FF', 'error');
                return;
            }
            
            // Validate URL
            if (!m3uUrl.startsWith('http://') && !m3uUrl.startsWith('https://')) {
                showResult(resultDiv, 'URL must start with http:// or https://', 'error');
                return;
            }
            
            // Store in localStorage (simulating portal storage)
            const devices = JSON.parse(localStorage.getItem('burgtv_devices') || '{}');
            const deviceData = {
                mac_address: macAddress.toUpperCase(),
                m3u_url: m3uUrl,
                device_type: 'firetv',
                device_name: 'Test Device',
                registered_at: new Date().toISOString()
            };
            
            devices[macAddress.toUpperCase()] = deviceData;
            localStorage.setItem('burgtv_devices', JSON.stringify(devices));
            
            let resultText = `‚úÖ Device Registered Successfully!\n\n`;
            resultText += `MAC Address: ${deviceData.mac_address}\n`;
            resultText += `M3U URL: ${deviceData.m3u_url}\n`;
            resultText += `Registered: ${deviceData.registered_at}\n\n`;
            resultText += `The device can now retrieve this configuration using its MAC address.`;
            
            showResult(resultDiv, resultText, 'success');
        }
        
        function viewDevices() {
            const resultDiv = document.getElementById('devicesResult');
            const devices = JSON.parse(localStorage.getItem('burgtv_devices') || '{}');
            
            if (Object.keys(devices).length === 0) {
                showResult(resultDiv, 'No devices registered yet.', 'info');
                return;
            }
            
            let resultText = `üì± Registered Devices (${Object.keys(devices).length}):\n\n`;
            
            for (const [mac, device] of Object.entries(devices)) {
                resultText += `MAC: ${mac}\n`;
                resultText += `  Type: ${device.device_type || 'unknown'}\n`;
                resultText += `  Name: ${device.device_name || 'Unnamed'}\n`;
                resultText += `  M3U: ${device.m3u_url}\n`;
                resultText += `  Registered: ${device.registered_at || 'Unknown'}\n\n`;
            }
            
            showResult(resultDiv, resultText, 'info');
        }
        
        function showResult(element, text, type) {
            element.className = `result ${type}`;
            element.textContent = text;
        }
        
        // Test on load
        window.addEventListener('DOMContentLoaded', function() {
            // Show a welcome message
            const resultDiv = document.getElementById('result');
            showResult(resultDiv, 
                'Welcome to the BurgTV Portal Test!\n\n' +
                'This page tests the portal\'s ability to accept dynamic IPTV URLs with parameters.\n' +
                'Click on any test URL above or enter your own URL to validate it.',
                'info'
            );
        });
    </script>
</body>
</html>